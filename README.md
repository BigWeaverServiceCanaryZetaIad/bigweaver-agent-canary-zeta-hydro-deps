# bigweaver-agent-canary-zeta-hydro-deps

[![Rust](https://img.shields.io/badge/rust-1.70%2B-blue.svg?maxAge=3600)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/license-Apache--2.0-blue.svg)](LICENSE)

This repository contains benchmarks and dependencies for [timely dataflow](https://github.com/TimelyDataflow/timely-dataflow) and [differential dataflow](https://github.com/TimelyDataflow/differential-dataflow) that were separated from the main bigweaver-agent-canary-hydro-zeta repository to isolate heavy dependencies and improve build times.

## ğŸ¯ Purpose

This repository serves as a dedicated benchmarking suite for timely and differential-dataflow, enabling performance comparisons with Hydroflow implementations. By separating these benchmarks, the main Hydroflow repository can:

- âš¡ **Reduce build times** - No need to compile heavy timely/differential dependencies
- ğŸ“¦ **Minimize binary sizes** - Smaller artifacts without additional dependencies
- ğŸ”§ **Avoid dependency conflicts** - Clean separation of dependency trees
- ğŸ“Š **Enable comprehensive comparisons** - Maintain baseline implementations for performance analysis
- ğŸ¨ **Improve code organization** - Clear separation of concerns

## ğŸ“š Documentation

- **[SETUP.md](SETUP.md)** - Comprehensive setup and installation guide
- **[BENCHMARKS.md](BENCHMARKS.md)** - Detailed documentation for each benchmark
- **[CONTRIBUTING.md](CONTRIBUTING.md)** - Guidelines for contributing to the benchmark suite
- **[benches/README.md](benches/README.md)** - Overview of the benchmark structure

## ğŸš€ Quick Start

### Prerequisites

- Rust 1.70 or later
- Cargo

### Installation

```bash
# Clone the repository
git clone <repository-url>
cd bigweaver-agent-canary-zeta-hydro-deps

# Build the project
cargo build

# Run all benchmarks
cargo bench

# Or use Make for convenience
make bench
```

For detailed setup instructions, see [SETUP.md](SETUP.md).

## ğŸ“Š Benchmarks

This repository includes 8 comprehensive benchmarks:

| Benchmark | Description | Implementations |
|-----------|-------------|----------------|
| **arithmetic** | Sequential arithmetic operations | Timely + baselines |
| **fan_in** | Multiple inputs to single output (Nâ†’1) | Timely + baselines |
| **fan_out** | Single input to multiple outputs (1â†’N) | Timely + baselines |
| **fork_join** | Fork-join dataflow patterns | Timely + baselines |
| **identity** | Identity/passthrough operations | Timely + baselines |
| **join** | Hash join between two streams | Timely + baselines |
| **reachability** | Graph reachability algorithm | Timely + Differential + baselines |
| **upcase** | String transformation operations | Timely + baselines |

Each benchmark includes multiple implementations:
- **Timely/Differential** - Framework implementations
- **Baselines** - Raw implementations (iter, pipeline, channels) for comparison

For detailed information about each benchmark, see [BENCHMARKS.md](BENCHMARKS.md).

## ğŸ”§ Usage

### Running Individual Benchmarks

```bash
# Run specific benchmark
cargo bench --bench arithmetic
cargo bench --bench reachability

# Using Make
make bench-arithmetic
make bench-reachability
```

### Running All Benchmarks

```bash
# Full benchmark suite (may take 15-30 minutes)
cargo bench

# Quick pass for development
make bench-quick
```

### Viewing Results

Benchmark results are generated by [Criterion.rs](https://github.com/bheisler/criterion.rs) and saved in `target/criterion/`:

```bash
# Open HTML report
open target/criterion/report/index.html

# On Linux
xdg-open target/criterion/report/index.html
```

## ğŸ“ˆ Performance Comparison

This repository works in conjunction with **bigweaver-agent-canary-hydro-zeta** (the main Hydroflow repository) to enable performance comparisons.

### Comparison Workflow

#### Using the Comparison Script (Recommended)

```bash
./compare_benchmarks.sh
```

The script provides an interactive menu to:
1. Run benchmarks in both repositories
2. Run benchmarks in deps repository only (timely/differential)
3. Run benchmarks in main repository only (Hydroflow)
4. Show comparison instructions

#### Manual Comparison

1. **Run timely/differential benchmarks** (this repository):
   ```bash
   cd bigweaver-agent-canary-zeta-hydro-deps
   cargo bench
   ```

2. **Run Hydroflow benchmarks** (main repository):
   ```bash
   cd ../bigweaver-agent-canary-hydro-zeta
   cargo bench -p benches
   ```

3. **Compare results**:
   - View HTML reports side by side
   - Use benchmark name mappings (see [BENCHMARKS.md](BENCHMARKS.md))
   - Use `critcmp` tool for automated comparison

### Benchmark Mappings

| This Repository | Main Repository (Hydroflow) |
|----------------|----------------------------|
| `arithmetic/timely` | `arithmetic/dfir_rs/*` |
| `reachability/timely` | `reachability/dfir_rs/*` |
| `reachability/differential` | `reachability/dfir_rs/*` |
| `join/timely` | `join/dfir_rs/*` |
| ... | ... |

Full mappings in [BENCHMARKS.md](BENCHMARKS.md).

## ğŸ› ï¸ Development

### Make Commands

The repository includes a comprehensive Makefile for common tasks:

```bash
# Build and test
make build          # Build all packages
make test           # Run tests
make check          # Check compilation

# Benchmarking
make bench          # Run all benchmarks
make bench-quick    # Quick benchmark pass
make bench-save     # Save baseline for comparison

# Code quality
make fmt            # Format code
make clippy         # Run lints
make all            # Format, lint, test, and build

# Utilities
make clean          # Clean build artifacts
make help           # Show all available commands
```

### Pre-commit Checks

Before committing changes:

```bash
make pre-commit
# Runs: format check, clippy, tests
```

## ğŸ—ï¸ Repository Structure

```
bigweaver-agent-canary-zeta-hydro-deps/
â”œâ”€â”€ Cargo.toml                     # Workspace configuration
â”œâ”€â”€ README.md                      # This file
â”œâ”€â”€ SETUP.md                       # Setup guide
â”œâ”€â”€ BENCHMARKS.md                  # Benchmark documentation
â”œâ”€â”€ CONTRIBUTING.md                # Contribution guidelines
â”œâ”€â”€ Makefile                       # Build automation
â”œâ”€â”€ compare_benchmarks.sh          # Comparison script
â””â”€â”€ benches/                       # Benchmark crate
    â”œâ”€â”€ Cargo.toml                 # Dependencies (timely, differential)
    â”œâ”€â”€ README.md                  # Benchmark overview
    â””â”€â”€ benches/                   # Benchmark implementations
        â”œâ”€â”€ arithmetic.rs          # Arithmetic operations
        â”œâ”€â”€ fan_in.rs              # Fan-in pattern
        â”œâ”€â”€ fan_out.rs             # Fan-out pattern
        â”œâ”€â”€ fork_join.rs           # Fork-join pattern
        â”œâ”€â”€ identity.rs            # Identity operations
        â”œâ”€â”€ join.rs                # Join operations
        â”œâ”€â”€ reachability.rs        # Graph reachability
        â”œâ”€â”€ reachability_edges.txt # Test data
        â”œâ”€â”€ reachability_reachable.txt
        â””â”€â”€ upcase.rs              # String transformation
```

## ğŸ¤ Contributing

We welcome contributions! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines on:

- Adding new benchmarks
- Updating existing benchmarks
- Code style and best practices
- Pull request process

### Quick Contribution Guide

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and benchmarks
5. Submit a pull request

## ğŸ”— Relationship to Main Repository

This repository is a companion to [bigweaver-agent-canary-hydro-zeta](https://github.com/BigWeaverServiceCanaryZetaIad/bigweaver-agent-canary-hydro-zeta), the main Hydroflow repository.

**Repository separation rationale:**
- Main repository focuses on Hydroflow (dfir_rs) implementations
- This repository focuses on timely/differential-dataflow comparisons
- Separation reduces build times and dependencies in the main repository
- Both repositories maintain comparable benchmark implementations

## ğŸ“Š Benchmark Results

Results are stored in Criterion format:

```
target/criterion/
â”œâ”€â”€ report/                        # HTML reports
â”‚   â””â”€â”€ index.html                # Main report page
â”œâ”€â”€ arithmetic/                   # Per-benchmark data
â”‚   â”œâ”€â”€ timely/
â”‚   â”‚   â””â”€â”€ base/
â”‚   â”‚       â””â”€â”€ estimates.json   # Statistical estimates
â”‚   â””â”€â”€ raw/
â”‚       â””â”€â”€ base/
â””â”€â”€ ...
```

## ğŸ” Performance Analysis

### Interpreting Results

Each benchmark shows:
- **Mean time** - Average execution time
- **Confidence interval** - Statistical confidence range
- **Throughput** - Operations per second (when applicable)
- **Comparison** - Change from previous run

Example output:
```
arithmetic/timely       time:   [45.123 ms 45.456 ms 45.789 ms]
                        change: [-2.3% -1.8% -1.2%] (p = 0.00 < 0.05)
                        Performance has improved.
```

### What to Look For

1. **Absolute Performance**: How fast is each implementation?
2. **Relative Performance**: How does timely/differential compare to baselines?
3. **Scalability**: How does performance change with data size?
4. **Consistency**: Are results stable across runs?

See [BENCHMARKS.md](BENCHMARKS.md) for detailed analysis guidelines.

## ğŸ› ï¸ Tools and Utilities

### Installed Tools

- **Criterion.rs** - Benchmarking framework
- **timely** - Timely dataflow framework
- **differential-dataflow** - Differential dataflow framework

### Optional Tools

```bash
# Install comparison tools
make install-tools

# Installs:
# - critcmp (result comparison)
# - cargo-watch (continuous testing)
# - flamegraph (profiling)
```

## ğŸ“ License

This project is licensed under the Apache License 2.0 - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- [Timely Dataflow](https://github.com/TimelyDataflow/timely-dataflow) - High-performance dataflow framework
- [Differential Dataflow](https://github.com/TimelyDataflow/differential-dataflow) - Incremental computation
- [Criterion.rs](https://github.com/bheisler/criterion.rs) - Benchmarking framework
- [Hydroflow](https://hydro.run/) - Main repository framework

## ğŸ“§ Support

- **Documentation**: Check [BENCHMARKS.md](BENCHMARKS.md) and [SETUP.md](SETUP.md)
- **Issues**: Open an issue on the repository
- **Questions**: Use GitHub discussions

## ğŸ—ºï¸ Roadmap

Future enhancements:
- [ ] Additional benchmarks for complex patterns
- [ ] Automated CI/CD benchmark comparisons
- [ ] Historical benchmark tracking
- [ ] Performance regression detection
- [ ] Multi-machine distributed benchmarks
- [ ] Memory profiling integration

---

**Quick Links:**
- [Setup Guide](SETUP.md)
- [Benchmark Details](BENCHMARKS.md)
- [Contributing](CONTRIBUTING.md)
- [Main Repository](https://github.com/BigWeaverServiceCanaryZetaIad/bigweaver-agent-canary-hydro-zeta)

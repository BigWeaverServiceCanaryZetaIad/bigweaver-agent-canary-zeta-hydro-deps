# Repository Structure

This document describes the structure and purpose of files in this repository.

## Root Directory

```
.
├── Cargo.toml          # Package configuration with benchmark definitions
├── build.rs            # Build script that generates benchmark code
├── .gitignore          # Git ignore rules for build artifacts
├── README.md           # Main repository documentation
├── SETUP.md            # Detailed setup and troubleshooting guide
├── MIGRATION.md        # Documentation of migration from main repo
├── QUICK_START.md      # Quick reference guide
├── STRUCTURE.md        # This file - explains repository structure
├── verify.sh           # Verification script for repository integrity
└── benches/            # Benchmark directory
```

## Benchmark Directory (`benches/`)

```
benches/
├── README.md                      # Benchmark documentation
├── .gitignore                     # Ignores generated files
├── arithmetic.rs                  # Arithmetic operations benchmark
├── fan_in.rs                      # Fan-in pattern benchmark
├── fan_out.rs                     # Fan-out pattern benchmark
├── fork_join.rs                   # Fork-join pattern benchmark
├── futures.rs                     # Async futures benchmark
├── identity.rs                    # Identity transformation benchmark
├── join.rs                        # Join operations benchmark
├── micro_ops.rs                   # Micro-operations benchmark
├── reachability.rs                # Graph reachability benchmark
├── symmetric_hash_join.rs         # Symmetric hash join benchmark
├── upcase.rs                      # String transformation benchmark
├── words_diamond.rs               # Diamond pattern benchmark
├── reachability_edges.txt         # Edge data for reachability tests
├── reachability_reachable.txt     # Expected reachable nodes
└── words_alpha.txt                # English word list (370K+ words)
```

## File Purposes

### Configuration Files

- **Cargo.toml**: Defines the package metadata, dependencies, and 12 benchmark targets
- **build.rs**: Generates `fork_join_20.hf` file at build time for the fork_join benchmark
- **.gitignore**: Prevents committing build artifacts, criterion results, IDE files, and generated code

### Documentation Files

- **README.md**: Main documentation with overview, usage, and benchmark descriptions
- **SETUP.md**: Step-by-step setup guide with troubleshooting
- **MIGRATION.md**: Details about the migration from the main repository
- **QUICK_START.md**: Quick reference for common commands and tasks
- **STRUCTURE.md**: This file explaining repository organization
- **benches/README.md**: Brief documentation specific to the benches directory

### Benchmark Files

Each `.rs` file in the `benches/` directory implements performance benchmarks:

#### Benchmarks with Timely/Differential Comparisons (8 files)
1. **arithmetic.rs**: Arithmetic operations (Hydro vs Timely)
2. **fan_in.rs**: Multiple streams merging (Hydro vs Timely)
3. **fan_out.rs**: Stream splitting (Hydro vs Timely)
4. **fork_join.rs**: Parallel fork-join patterns (Hydro vs Timely)
5. **identity.rs**: Passthrough transformations (Hydro vs Timely)
6. **join.rs**: Stream join operations (Hydro vs Timely)
7. **reachability.rs**: Graph reachability algorithms (Hydro vs Timely vs Differential)
8. **upcase.rs**: String case transformations (Hydro vs Timely)

#### Hydro-Specific Benchmarks (4 files)
9. **futures.rs**: Async/await and futures handling
10. **micro_ops.rs**: Micro-level operations performance
11. **symmetric_hash_join.rs**: Symmetric hash join implementation
12. **words_diamond.rs**: Diamond pattern with word processing

### Data Files

- **reachability_edges.txt** (521 KB): Contains 55,008 graph edges for reachability testing
- **reachability_reachable.txt** (38 KB): Contains expected reachable nodes for validation
- **words_alpha.txt** (3.7 MB): Contains 370,104 English words for string processing tests

### Utility Files

- **verify.sh**: Bash script that verifies all required files are present and correctly configured

## Build Artifacts (Not Committed)

When you build the project, these directories/files are created:

```
target/                      # Cargo build output
├── debug/                   # Debug build artifacts
├── release/                 # Release build artifacts
└── criterion/               # Benchmark results
    └── report/              # HTML reports
        └── index.html       # Main results page
benches/fork_join_20.hf      # Generated by build.rs
```

## Dependencies

### External Crates

From crates.io:
- `criterion` - Benchmark framework
- `futures` - Async runtime
- `rand`, `rand_distr` - Random number generation
- `nameof`, `seq-macro`, `static_assertions` - Helper macros
- `tokio` - Async runtime
- `timely` (as timely-master) - Timely Dataflow
- `differential-dataflow` (as differential-dataflow-master) - Differential Dataflow

### Git Dependencies

From main Hydro repository:
- `dfir_rs` - Hydro's DFIR runtime (with debugging features)
- `sinktools` - Utility tools

## Workflow

1. **Clone**: User clones this repository
2. **Build**: `cargo build` fetches git dependencies and compiles
3. **Generate**: `build.rs` creates `fork_join_20.hf`
4. **Benchmark**: `cargo bench` runs all benchmarks
5. **Report**: HTML reports generated in `target/criterion/`

## Size Information

- Total repository size: ~9.6 MB
- Largest files:
  - `words_alpha.txt`: 3.7 MB
  - `reachability_edges.txt`: 521 KB
  - `reachability_reachable.txt`: 38 KB
- Total benchmark code: ~71 KB (12 files)
- Total documentation: ~30 KB (5 files)

## Maintenance

To keep this repository in sync with the main Hydro repository:

1. Git dependencies automatically use the latest main branch
2. Run `cargo update` to fetch latest commits
3. Re-run benchmarks to verify compatibility
4. Update documentation if APIs change

For local development against a specific branch:

```toml
# Edit Cargo.toml
dfir_rs = { 
    git = "https://github.com/BigWeaverServiceCanaryZetaIad/bigweaver-agent-canary-hydro-zeta",
    branch = "your-feature-branch",
    features = [ "debugging" ] 
}
```
